<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Autocomplete</title>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.9.0/themes/smoothness/jquery-ui.css" />
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<!-- Popper JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <style type="text/css">
        .ui-helper-hidden-accessible { position: absolute; left: -9999px; }
        .ui-autocomplete { max-height: 200px; overflow-y: auto; overflow-x: hidden;}
    </style>
	<link href="http://code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css" rel="Stylesheet"></link>
	<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
	<script src="https://sdk.amazonaws.com/js/aws-sdk-2.320.0.min.js?v1.3"></script>

	<script src="http://code.jquery.com/ui/1.10.2/jquery-ui.js" ></script>
  
    <script type="text/javascript">
    

	var $j = jQuery.noConflict();
	var urlPart1	=	"https://3a7721e6.qb0x.com:30002/ymmv1/_search?pretty"
	var urlPart3	=	"&fq=make%3A'Honda'&return=_all_fields";
	var availableTags	=	[];
	var bla = '2000 ACURA EL';
	

	
	var postData	=	{
 "suggest": {
 "film_suggestion" : {
 "prefix" : "Ba",
 "completion" : {
 "field" : "suggest",
 "size": 10,
 "contexts": {
 "yearmakemodel": [ "2000ACURAEL" ]
 }
 }
 }
 }
}

	var gethttpData	=	{
    "query": {
        "query_string": {
            "query": "Engine33 Compartment1rrr"
			
        }
    },
	"size": 20
}



   postDataPhrase	=	 {
	"query": {
        "match_phrase": {
            "output": {
                "query": "Engine",
                "slop": 30
            }
        }
    }
}

postDataPhraseFilter	=	 {
    "query": {
        "bool" : {
            "must" : [
                {"match" : { "output" : {"query" : "Radiotor"} }}
            ],
			
            "filter" : {
                "terms" : {
                    "yearmakemodel_desc" : ["2000 ACURA EL"]
                }
            }
        }
    }
}


    	$j(function () {
		$j('#yearmakemodel').val(bla);
            var getData = function (request, response) {
				
				bla = $j('#yearmakemodel').val();
				console.log('YearMakeModel ',bla);
				
				postData.suggest.film_suggestion.completion.contexts.yearmakemodel	=	bla;
				gethttpData.query.query_string.query	=	request.term;
				postDataPhrase.query.match_phrase.output.query	=	request.term;
				
				console.log(postDataPhraseFilter.query.bool);
				
				postDataPhraseFilter.query.bool.must[0].match.output.query	=	request.term;
				//postDataPhraseFilter.query.bool.filter.terms.yearmakemodel_desc	=	bla;
		
				var posttingData	=	postDataPhraseFilter;//postDataPhrase;
				console.log(JSON.stringify(posttingData));
				
				$j.ajax({
					type: 'POST',
					url: urlPart1,
					data: JSON.stringify(posttingData), 
					success: function(data) { 
					console.log(data.hits.hits[0]);
						console.log(data);
						console.log(data.hits.hits[0]._source.output);
						
						var fruitsArray	=	data.hits.hits;
						
						
						$j("#result").empty();
						
						$j.each(fruitsArray, function(index, value){
						
							$j("#result").append(index + ": " + value._source.output + ': ' +value._source.yearmakemodel_desc+'<br>');
						});
						
					},
					contentType: "application/json",
					dataType: 'json',
					 headers: {
					"Authorization": "Basic " + btoa('1fd0748f43709cb08803' + ":" + 'e4fd5698e6')
  }
				});						
            };

            var selectItem = function (event, ui) {
            	console.log('selectionItem Called ',ui);
            	$j("#searchText").val(ui.item.value);
            }

            $j("#searchText").autocomplete({
                source: getData,
                select: selectItem,
                minLength: 2
            });

        });
    </script>
</head>
<body>
<div style='margin-left:20px;' class='col-md-8'>
	<div class='row'>
		<h5>QBOX-PHRASE AND FILTER</h5>
	</div>	
	<div class='row'>
		<div class='col-md-4'>
			YearMakeModel
		</div>
	
		<div class='col-md-4'>
			<input type="text" , id="yearmakemodel"/>
		</div>
		
	</div>
	
	<div style='margin-top:10px;' class='row'>
		<div class='col-md-4'>
			Search
		</div>
	
		<div class='col-md-4'>
			<input type="text" , id="searchText"/>
		</div>
		<div class='col-md-4'>
			<input type="button" , id="searchAWS" onclick='searchAWS()'/>
		</div>
	</div>
    <div id="result"></div>
</div>	
</body>
</html>